<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>进阶用法 | wechat-miniprogram / kbone</title>
    <meta name="description" content="Web 与小程序同构解决方案">
    <link rel="shortcut icon" href="/kbone/docs/favicon.ico">
    
    <link rel="preload" href="/kbone/docs/assets/css/0.styles.3fea5485.css" as="style"><link rel="preload" href="/kbone/docs/assets/js/app.1e643540.js" as="script"><link rel="preload" href="/kbone/docs/assets/js/2.4d830d36.js" as="script"><link rel="preload" href="/kbone/docs/assets/js/23.23925626.js" as="script"><link rel="prefetch" href="/kbone/docs/assets/js/10.55c22f35.js"><link rel="prefetch" href="/kbone/docs/assets/js/11.3756a644.js"><link rel="prefetch" href="/kbone/docs/assets/js/12.37482013.js"><link rel="prefetch" href="/kbone/docs/assets/js/13.1d703e67.js"><link rel="prefetch" href="/kbone/docs/assets/js/14.c7d32aba.js"><link rel="prefetch" href="/kbone/docs/assets/js/15.12c63557.js"><link rel="prefetch" href="/kbone/docs/assets/js/16.ab2d75bb.js"><link rel="prefetch" href="/kbone/docs/assets/js/17.9d2d252e.js"><link rel="prefetch" href="/kbone/docs/assets/js/18.1f0c5250.js"><link rel="prefetch" href="/kbone/docs/assets/js/19.7ce98193.js"><link rel="prefetch" href="/kbone/docs/assets/js/20.09ea31cf.js"><link rel="prefetch" href="/kbone/docs/assets/js/21.b2f09013.js"><link rel="prefetch" href="/kbone/docs/assets/js/22.9b764a97.js"><link rel="prefetch" href="/kbone/docs/assets/js/24.bb4fe9cb.js"><link rel="prefetch" href="/kbone/docs/assets/js/25.37769e5a.js"><link rel="prefetch" href="/kbone/docs/assets/js/26.10726c68.js"><link rel="prefetch" href="/kbone/docs/assets/js/27.be27163a.js"><link rel="prefetch" href="/kbone/docs/assets/js/28.85ff575a.js"><link rel="prefetch" href="/kbone/docs/assets/js/29.1726452a.js"><link rel="prefetch" href="/kbone/docs/assets/js/3.8e1fdef4.js"><link rel="prefetch" href="/kbone/docs/assets/js/30.a5996b76.js"><link rel="prefetch" href="/kbone/docs/assets/js/31.88ac7332.js"><link rel="prefetch" href="/kbone/docs/assets/js/32.4d47c9df.js"><link rel="prefetch" href="/kbone/docs/assets/js/33.daeab364.js"><link rel="prefetch" href="/kbone/docs/assets/js/34.94aeb57d.js"><link rel="prefetch" href="/kbone/docs/assets/js/35.90c2fe69.js"><link rel="prefetch" href="/kbone/docs/assets/js/36.a0c44764.js"><link rel="prefetch" href="/kbone/docs/assets/js/37.6886e57f.js"><link rel="prefetch" href="/kbone/docs/assets/js/38.86532960.js"><link rel="prefetch" href="/kbone/docs/assets/js/39.68fae4e9.js"><link rel="prefetch" href="/kbone/docs/assets/js/4.eef3413e.js"><link rel="prefetch" href="/kbone/docs/assets/js/40.75407ded.js"><link rel="prefetch" href="/kbone/docs/assets/js/41.fc6ed402.js"><link rel="prefetch" href="/kbone/docs/assets/js/42.80cfa782.js"><link rel="prefetch" href="/kbone/docs/assets/js/43.b36103ee.js"><link rel="prefetch" href="/kbone/docs/assets/js/44.6e9f5b7f.js"><link rel="prefetch" href="/kbone/docs/assets/js/45.f88d4501.js"><link rel="prefetch" href="/kbone/docs/assets/js/46.151923cf.js"><link rel="prefetch" href="/kbone/docs/assets/js/47.edad1b15.js"><link rel="prefetch" href="/kbone/docs/assets/js/48.6ebdb751.js"><link rel="prefetch" href="/kbone/docs/assets/js/49.6fb386a7.js"><link rel="prefetch" href="/kbone/docs/assets/js/5.7431891c.js"><link rel="prefetch" href="/kbone/docs/assets/js/50.7ad1275f.js"><link rel="prefetch" href="/kbone/docs/assets/js/51.1fa612d3.js"><link rel="prefetch" href="/kbone/docs/assets/js/52.feb707a2.js"><link rel="prefetch" href="/kbone/docs/assets/js/53.97224f16.js"><link rel="prefetch" href="/kbone/docs/assets/js/54.bb72cc13.js"><link rel="prefetch" href="/kbone/docs/assets/js/55.ef143b33.js"><link rel="prefetch" href="/kbone/docs/assets/js/6.85fe53aa.js"><link rel="prefetch" href="/kbone/docs/assets/js/7.f3ca80e0.js"><link rel="prefetch" href="/kbone/docs/assets/js/8.885c1494.js"><link rel="prefetch" href="/kbone/docs/assets/js/9.a28f1f1b.js">
    <link rel="stylesheet" href="/kbone/docs/assets/css/0.styles.3fea5485.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/kbone/docs/" class="home-link router-link-active"><img src="/kbone/docs/logo.svg" alt="wechat-miniprogram / kbone" class="logo"> <span class="site-name can-hide">wechat-miniprogram / kbone</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/kbone/docs/" class="nav-link">指南</a></div><div class="nav-item"><a href="/kbone/docs/config/" class="nav-link">配置</a></div><div class="nav-item"><a href="/kbone/docs/domextend/" class="nav-link">dom/bom 扩展 API</a></div><div class="nav-item"><a href="/kbone/docs/qa/" class="nav-link">Q&amp;A</a></div><div class="nav-item"><a href="/kbone/docs/changelog/" class="nav-link">更新日志</a></div><div class="nav-item"><a href="/kbone/docs/ui/intro/" class="nav-link">kbone-ui</a></div><div class="nav-item"><a href="https://github.com/wechat-miniprogram/kbone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/kbone/docs/" class="nav-link">指南</a></div><div class="nav-item"><a href="/kbone/docs/config/" class="nav-link">配置</a></div><div class="nav-item"><a href="/kbone/docs/domextend/" class="nav-link">dom/bom 扩展 API</a></div><div class="nav-item"><a href="/kbone/docs/qa/" class="nav-link">Q&amp;A</a></div><div class="nav-item"><a href="/kbone/docs/changelog/" class="nav-link">更新日志</a></div><div class="nav-item"><a href="/kbone/docs/ui/intro/" class="nav-link">kbone-ui</a></div><div class="nav-item"><a href="https://github.com/wechat-miniprogram/kbone" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/kbone/docs/" class="sidebar-link">kbone 是什么？</a></li><li><a href="/kbone/docs/guide/quickstart.html" class="sidebar-link">快速上手</a></li><li><a href="/kbone/docs/guide/tutorial.html" class="sidebar-link">kbone 项目搭建流程</a></li><li><a href="/kbone/docs/guide/advanced.html" class="active sidebar-link">进阶用法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/kbone/docs/guide/advanced.html#环境判断" class="sidebar-link">环境判断</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/guide/advanced.html#多页开发" class="sidebar-link">多页开发</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/guide/advanced.html#使用小程序内置组件" class="sidebar-link">使用小程序内置组件</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/guide/advanced.html#使用小程序自定义组件" class="sidebar-link">使用小程序自定义组件</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/guide/advanced.html#使用-rem" class="sidebar-link">使用 rem</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/guide/advanced.html#自定义-app-js-和-app-wxss" class="sidebar-link">自定义 app.js 和 app.wxss</a></li><li class="sidebar-sub-header"><a href="/kbone/docs/guide/advanced.html#扩展-dom-bom-对象和-api" class="sidebar-link">扩展 dom/bom 对象和 API</a></li></ul></li><li><a href="/kbone/docs/guide/principle.html" class="sidebar-link">原理</a></li><li><a href="/kbone/docs/guide/optimize.html" class="sidebar-link">代码优化</a></li><li><a href="/kbone/docs/guide/suggest.html" class="sidebar-link">开发建议</a></li><li><a href="/kbone/docs/guide/develop.html" class="sidebar-link">贡献规范</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="进阶用法"><a href="#进阶用法" class="header-anchor">#</a> 进阶用法</h1> <p>因为 Web 端和小程序端的差异性，此文档提供了一些进阶用法、优化方式和开发建议。</p> <h2 id="环境判断"><a href="#环境判断" class="header-anchor">#</a> 环境判断</h2> <p>对于开发者来说，可能需要针对不同端做一些特殊的逻辑，因此也就需要一个方法来判断区分不同的环境。kbone 推荐的做法是通过 webpack 注入一个环境变量：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.mp.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token string">'process.env.isMiniprogram'</span><span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">// ... other options</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// ... other options</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>后续在业务代码中，就可以通过 <code>process.env.isMiniprogram</code> 来判断是否在小程序环境：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>isMiniprogram<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in miniprogram'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'in web'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="多页开发"><a href="#多页开发" class="header-anchor">#</a> 多页开发</h2> <p>对于多页面的应用，在 Web 端可以直接通过 a 标签或者 location 对象进行跳转，但是在小程序中则行不通；同时 Web 端的页面 url 实现和小程序页面路由也是完全不一样的，因此对于多页开发最大的难点在于如何进行页面跳转。</p> <ol><li>修改 webpack 配置</li></ol> <p>对于多页应用，此处和 Web 端一致，有多少个页面就需要配置多少个入口文件。如下例子，这个应用中包含 page1、page2 和 page2 三个页面：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.mp.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        page1<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/page1/main.mp.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        page2<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/page2/main.mp.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        page3<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/page3/main.mp.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ... other options</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="2"><li>修改 webpack 插件配置</li></ol> <p><code>mp-webpack-plugin</code> 这个插件的配置同样需要调整，需要开发者提供各个页面对应的 url 给 kbone。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    origin<span class="token punctuation">:</span> <span class="token string">'https://test.miniprogram.com'</span><span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> <span class="token string">'/page1'</span><span class="token punctuation">,</span>
    router<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        page1<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'/(home|page1)?'</span><span class="token punctuation">,</span> <span class="token string">'/test/(home|page1)'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        page2<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'/test/page2/:id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        page3<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'/test/page3/:id'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ... other options</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>其中 origin 即 window.location.origin 字段，使用 kbone 的应用所有页面必须同源，不同源的页面禁止访问。entry 页面表示这个应用的入口 url。router 配置则是各个页面对应的 url，可以看到每个页面可能不止对应一个 url，而且这里的 url 支持参数配置。</p> <p>有了以上几个配置后，就可以在 kbone 内使用 a 标签或者 location 对象进行跳转。kbone 会将要跳转的 url 进行解析，然后根据配置中的 origin 和 router 查找出对应的页面，然后拼出页面在小程序中的路由，最后通过小程序 API 进行跳转（利用 wx.redirectTo 等方法）。</p> <blockquote><p>PS：通过多页可以支持使用小程序 tabBar，还可以使用小程序分包与预下载机制，更多详细配置信息可以<a href="/kbone/docs/config/">点此查看</a>。</p></blockquote> <blockquote><p>PS：具体例子可参考 <a href="https://github.com/wechat-miniprogram/kbone/tree/develop/examples/demo5" target="_blank" rel="noopener noreferrer">demo5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 和 <a href="https://github.com/wechat-miniprogram/kbone/tree/develop/examples/demo7" target="_blank" rel="noopener noreferrer">demo7<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="使用小程序内置组件"><a href="#使用小程序内置组件" class="header-anchor">#</a> 使用小程序内置组件</h2> <p>需要明确的是，如果没有特殊需求的话，请尽量使用 html 标签来编写代码，使用内置组件时请按需使用。这是因为绝大部分内置组件外层都会被包裹一层自定义组件，如果自定义组件的实例数量达到一定量级的话，理论上是会对性能造成一定程度的影响，所以对于 view、text、image 等会被频繁使用的内置组件，如果没有特殊需求的话请直接使用 div、span、img 等 html 标签替代。</p> <p>部分内置组件可以直接使用 html 标签替代，比如 input 组件可以使用 input 标签替代。目前已支持的可替代组件列表：</p> <ul><li><code>&lt;input /&gt;</code> --&gt; input 组件</li> <li><code>&lt;input type=&quot;radio&quot; /&gt;</code> --&gt; radio 组件</li> <li><code>&lt;input type=&quot;checkbox&quot; /&gt;</code> --&gt; checkbox 组件</li> <li><code>&lt;label&gt;&lt;label&gt;</code> --&gt; label 组件</li> <li><code>&lt;textarea&gt;&lt;/textarea&gt;</code> --&gt; textarea 组件</li> <li><code>&lt;img /&gt;</code> --&gt; image 组件</li> <li><code>&lt;video&gt;&lt;/video&gt;</code>  --&gt; video 组件</li> <li><code>&lt;canvas&gt;&lt;/canvas&gt;</code> --&gt; canvas 组件</li></ul> <p>还有一部分内置组件在 html 中没有标签可替代，那就需要使用 <code>wx-component</code> 标签或者使用 <code>wx-</code> 前缀，基本用法如下：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- wx-component 标签用法 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wx-component</span> <span class="token attr-name">behavior</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>picker<span class="token punctuation">&quot;</span></span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>region<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>选择城市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wx-component</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wx-component</span> <span class="token attr-name">behavior</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>button<span class="token punctuation">&quot;</span></span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>share<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onClickShare<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>分享<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wx-component</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- wx- 前缀用法 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wx-picker</span> <span class="token attr-name">mode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>region<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onChange<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>选择城市<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wx-picker</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wx-button</span> <span class="token attr-name">open-type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>share<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onClickShare<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>分享<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wx-button</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>如果使用 <code>wx-component</code> 标签表示要渲染小程序内置组件，然后 behavior 字段表示要渲染的组件名；其他组件属性传入和官方文档一致，事件则采用 vue 的绑定方式。</p> <p><code>wx-component</code> 或 <code>wx-</code> 前缀已支持内置组件列表：</p> <ul><li>cover-image 组件</li> <li>cover-view 组件</li> <li>movable-area 组件</li> <li>movable-view 组件</li> <li>scroll-view 组件</li> <li>swiper 组件</li> <li>swiper-item 组件</li> <li>view 组件</li> <li>icon 组件</li> <li>progress 组件</li> <li>text 组件</li> <li>button 组件</li> <li>editor 组件</li> <li>form 组件</li> <li>picker 组件</li> <li>picker-view 组件</li> <li>picker-view-column 组件</li> <li>slider 组件</li> <li>switch 组件</li> <li>navigator 组件</li> <li>camera 组件</li> <li>image 组件</li> <li>live-player 组件</li> <li>live-pusher 组件</li> <li>map 组件</li> <li>ad 组件</li> <li>official-account 组件</li> <li>open-data 组件</li> <li>web-view 组件</li></ul> <blockquote><p>PS：button 标签不会被渲染成 button 内置组件，同理 form 标签也不会被渲染成 form 内置组件，如若需要请按照上述原生组件使用说明使用。</p></blockquote> <blockquote><p>PS：因为自定义组件的限制，movable-area/movable-view、swiper/swiper-item、picker-view/picker-view-column 这三组组件必须作为父子存在才能使用，比如 swiper 组件和 swiper-item 必须作为父子组件才能使用，如：</p></blockquote> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wx-swiper</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wx-swiper-item</span><span class="token punctuation">&gt;</span></span>A<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wx-swiper-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wx-swiper-item</span><span class="token punctuation">&gt;</span></span>B<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wx-swiper-item</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>wx-swiper-item</span><span class="token punctuation">&gt;</span></span>C<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wx-swiper-item</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>wx-swiper</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><blockquote><p>PS：原生组件的表现在小程序中表现会和 web 端标签有些不一样，具体可<a href="https://developers.weixin.qq.com/miniprogram/dev/component/native-component.html" target="_blank" rel="noopener noreferrer">参考原生组件说明文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p></blockquote> <blockquote><p>PS：原生组件下的子节点，div、span 等标签会被渲染成 cover-view，img 会被渲染成 cover-image，如若需要使用 button 内置组件请使用 <code>wx-component</code> 或 <code>wx-</code> 前缀。</p></blockquote> <blockquote><p>PS：如果将插件配置 runtime.wxComponent 的值配置为 <code>noprefix</code>，则可以用不带前缀的方式使用内置组件。</p></blockquote> <blockquote><p>PS：具体例子可参考 <a href="https://github.com/wechat-miniprogram/kbone/tree/develop/examples/demo3" target="_blank" rel="noopener noreferrer">demo3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="使用小程序自定义组件"><a href="#使用小程序自定义组件" class="header-anchor">#</a> 使用小程序自定义组件</h2> <p>需要明确的是，如果可以使用 Web 端组件技术实现的话请尽量使用 Web 端技术（如 vue、react 组件），使用自定义组件请按需使用。这是因为自定义组件外层会被包裹上 kbone 的自定义组件，而当自定义组件的实例数量达到一定量级的话，理论上是会对性能造成一定程度的影响。</p> <p>要在 kbone 中使用自定义组件，需要将所有自定义组件和其依赖放到一个固定的目录，这个目录可以自己拟定，假设这个目录为 <code>src/custom-components</code>：</p> <ol><li>修改 webpack 插件配置</li></ol> <p>在 <code>mp-webpack-plugin</code> 这个插件的配置中的 generate 字段内补充 <strong>wxCustomComponent</strong>，其中 root 是组件根目录，即上面提到的目录：<code>src/custom-component</code>，usingComponents 则用来配置要用到的自定义组件。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    generate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        wxCustomComponent<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            root<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/custom-components'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            usingComponents<span class="token punctuation">:</span> <span class="token punctuation">{</span>
                <span class="token string">'comp-a'</span><span class="token punctuation">:</span> <span class="token string">'comp-a/index'</span><span class="token punctuation">,</span>
                <span class="token string">'comp-b'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
                    path<span class="token punctuation">:</span> <span class="token string">'comp-b/index'</span><span class="token punctuation">,</span>
                    props<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'propa'</span><span class="token punctuation">,</span> <span class="token string">'propb'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                    events<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'someevent'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ... other options</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>usingComponents 里的声明和小程序页面的 usingComponents 字段类似。键为组件名，值可以为组件相对 root 字段的路径，也可以是一个配置对象。这个配置对象的 path 为组件相对路径，props 表示要这个组件会被用到的 properties，events 表示这个组件会被监听到的事件。</p> <ol start="2"><li>将自定义组件放入组件根目录</li></ol> <p>下面以 comp-b 组件为例：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token comment">&lt;!-- comp-b.wxml --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>comp-b<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>view</span><span class="token punctuation">&gt;</span></span>propa: {{propa}} -- propb: {{propb}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>view</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">bintap</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onTap<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>click me<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// comp-b.js</span>
<span class="token function">Component</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    properties<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        propa<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        propb<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function">onTap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">triggerEvent</span><span class="token punctuation">(</span><span class="token string">'someevent'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><ol start="3"><li>使用自定义组件</li></ol> <p>假设使用 vue 技术，然后下面同样以 comp-b 组件为例：</p> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>comp-b</span> <span class="token attr-name">:propa</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>propa<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:propb</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>propb<span class="token punctuation">&quot;</span></span> <span class="token attr-name">@someevent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onEvent<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>comp-b slot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>comp-b</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>propa<span class="token punctuation">:</span> <span class="token string">'propa-value'</span><span class="token punctuation">,</span> propb<span class="token punctuation">:</span> <span class="token string">'propb-value'</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function">onEvent</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'someevent'</span><span class="token punctuation">,</span> evt<span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><blockquote><p>PS：如果使用 react 等其他框架其实和 vue 同理，因为它们的底层都是调用 document.createElement 来创建节点。当在 webpack 插件配置声明了这个自定义组件的情况下，在调用 document.createElement 创建该节点时会被转换成创建 wx-custom-component 标签，类似于内置组件的 wx-component 标签。</p></blockquote> <blockquote><p>PS：具体例子可参考 <a href="https://github.com/wechat-miniprogram/kbone/tree/develop/examples/demo10" target="_blank" rel="noopener noreferrer">demo10<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="使用-rem"><a href="#使用-rem" class="header-anchor">#</a> 使用 rem</h2> <p>kbone 没有支持 rpx，取而代之的是可以使用更为传统的 rem 进行开发。使用流程如下：</p> <ol><li>修改 webpack 插件配置</li></ol> <p>在 <code>mp-webpack-plugin</code> 这个插件的配置中的 global 字段内补充 <strong>rem</strong> 配置。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    global<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        rem<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ... other options</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="2"><li>在业务代码里就可以设置 html 的 font-size 样式了，比如如下方式：</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span>isMiniprogram<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 小程序</span>
        document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> wx<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>screenWidth <span class="token operator">/</span> <span class="token number">16</span> <span class="token operator">+</span> <span class="token string">'px'</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Web 端</span>
        document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>style<span class="token punctuation">.</span>fontSize <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span><span class="token function">getBoundingClientRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">16</span> <span class="token operator">+</span> <span class="token string">'px'</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ol start="3"><li>在业务代码的样式里使用 rem。</li></ol> <div class="language-css line-numbers-mode"><pre class="language-css"><code><span class="token selector">.content</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 10rem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>PS：这个特性只在基础库 2.9.0 及以上版本支持。</p></blockquote> <h2 id="自定义-app-js-和-app-wxss"><a href="#自定义-app-js-和-app-wxss" class="header-anchor">#</a> 自定义 app.js 和 app.wxss</h2> <p>在开发过程中，可能需要监听 app 的生命周期，这就需要开发者自定义 app.js。</p> <ol><li>修改 webpack 配置</li></ol> <p>首先需要在 webpack 配置中补上 app.js 的构建入口，比如下面代码的 <code>miniprogram-app</code> 入口：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// webpack.mp.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    entry<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">'miniprogram-app'</span><span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/app.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        page1<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/page1/main.mp.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        page2<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/page2/main.mp.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ... other options</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ol start="2"><li>修改 webpack 插件配置</li></ol> <p>在 webpack 配置补完入口，还需要在 <code>mp-webpack-plugin</code> 这个插件的配置中补充说明，不然 kbone 会将 <code>miniprgram-app</code> 入口作为页面处理。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
    generate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        app<span class="token punctuation">:</span> <span class="token string">'miniprogram-app'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ... other options</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如上，将 webpack 构建中的入口名称设置在插件配置的 generate.app 字段上，那么构建时 kbone 会将这个入口的构建作为 app.js 处理。</p> <ol start="3"><li>补充 src/app.js</li></ol> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 自定义 app.wxss</span>
<span class="token keyword">import</span> <span class="token string">'./app.css'</span>

<span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">onLaunch</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onShow</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 获取当前页面实例</span>
        <span class="token keyword">const</span> pages <span class="token operator">=</span> <span class="token function">getCurrentPages</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">const</span> currentPage <span class="token operator">=</span> pages<span class="token punctuation">[</span>pages<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span>

        <span class="token comment">// 获取当前页面的 window 对象和 document 对象</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>currentPage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>currentPage<span class="token punctuation">.</span>window<span class="token punctuation">)</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>currentPage<span class="token punctuation">.</span>document<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onHide</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onError</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onPageNotFound</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><blockquote><p>PS：app.js 不属于任何页面，所以没有真正的 window 和 document 对象，所有依赖这两个对象实现的代码在这里无法被直接使用。</p></blockquote> <blockquote><p>PS：具体例子可参考 <a href="https://github.com/wechat-miniprogram/kbone/tree/develop/examples/demo5" target="_blank" rel="noopener noreferrer">demo5<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="扩展-dom-bom-对象和-api"><a href="#扩展-dom-bom-对象和-api" class="header-anchor">#</a> 扩展 dom/bom 对象和 API</h2> <p>kbone 能够满足大多数常见的开发场景，但是当遇到当前 dom/bom 接口不能满足的情况时，kbone 也提供了一系列 API 来扩展 dom/bom 对象和接口。</p> <p>这里需要注意的是，下述所有对于 dom/bom 对象的扩展都是针对所有页面的，也就是说有一个页面对其进行了扩展，所有页面都会生效，因此在使用扩展时建议做好处理标志，然后判断是否已经被扩展过。</p> <ul><li>使用 window.$$extend 对 dom/bom 对象追加属性/方法</li></ul> <p>举个例子，假设需要对 <code>window.location</code> 对象追加一个属性 testStr 和一个方法 testFunc，可以编写如下代码：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>window<span class="token punctuation">.</span><span class="token function">$$extend</span><span class="token punctuation">(</span><span class="token string">'window.location'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    testStr<span class="token punctuation">:</span> <span class="token string">'I am location'</span><span class="token punctuation">,</span>
    <span class="token function">testFunc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>testStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这样便可以通过 <code>window.location.testStr</code> 获取新追加的属性，同时可以通过 <code>window.location.testFunc()</code> 调用新追加的方法。</p> <ul><li>使用 window.$$getPrototype 获取 dom/bom 对象的原型</li></ul> <p>如果遇到追加属性和追加方法都无法满足需求的情况下，可以获取到对应对象的原型进行操作：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> locationPrototype <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token function">$$getPrototype</span><span class="token punctuation">(</span><span class="token string">'window.location'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如上例子，locationPrototype 便是 window.location 对象的原型。</p> <ul><li>对 dom/bom 对象方法追加前置/后置处理</li></ul> <p>除了上述的给对象新增和覆盖方法，还可以对已有的方法进行前置/后置处理。</p> <p>前置处理即表示此方法会在执行原始方法之前执行，后置处理则是在之后执行。前置处理方法接收到的参数和原始方法接收到的参数一致，后置处理方法接收到的参数则是原始方法执行后返回的结果。下面给一个简单的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">beforeAspect</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在执行 window.location.testFunc 前被调用，args 为调用该方法时传入的参数</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">afterAspect</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在执行 window.location.testFunc 后被调用，res 为该方法返回结果</span>
<span class="token punctuation">}</span>
window<span class="token punctuation">.</span><span class="token function">$$addAspect</span><span class="token punctuation">(</span><span class="token string">'window.location.testFunc.before'</span><span class="token punctuation">,</span> beforeAspect<span class="token punctuation">)</span>
window<span class="token punctuation">.</span><span class="token function">$$addAspect</span><span class="token punctuation">(</span><span class="token string">'window.location.testFunc.after'</span><span class="token punctuation">,</span> afterAspect<span class="token punctuation">)</span>

window<span class="token punctuation">.</span>location<span class="token punctuation">.</span><span class="token function">testFunc</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">)</span> <span class="token comment">// 会执行 beforeAspect，再调用 testFunc，最后再执行 afterAspect</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><blockquote><p>PS：具体 API 可参考 <a href="/kbone/docs/domextend/">dom/bom 扩展 API</a> 文档。</p></blockquote></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/kbone/docs/guide/tutorial.html" class="prev">kbone 项目搭建流程</a></span> <span class="next"><a href="/kbone/docs/guide/principle.html">原理</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/kbone/docs/assets/js/app.1e643540.js" defer></script><script src="/kbone/docs/assets/js/2.4d830d36.js" defer></script><script src="/kbone/docs/assets/js/23.23925626.js" defer></script>
  </body>
</html>
